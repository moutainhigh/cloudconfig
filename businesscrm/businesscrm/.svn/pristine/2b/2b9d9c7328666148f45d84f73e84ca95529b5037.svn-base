<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xkd.mapper.UserInfoMapper" >

 
  <select id="selectUserInfoById" resultType="map" >
    select
          id,
          companyId,
          uname,
          station,
          mobile,
          phone,
          email,
          sex,
          age,
          birth,
          udesc,
          userResource,
          personAnalysis,
          createdBy,
          createDate
      from dc_user_company where id = #{id}
  </select>




  
  <select id="selectUserInfoByCompanyId" resultType="java.util.Map" >
			SELECT
				  id,
                  companyId,
                  uname,
                  station,
                  mobile,
                  phone,
                  email,
                  sex,
                  age,
                  birth,
                  udesc,
                  userResource,
                  personAnalysis,
                  createdBy,
                  createDate
			FROM
				dc_user_company d
			WHERE
				d.companyId = #{companyId} 
  </select>
  

  <insert id="insertUserInfo" parameterType="java.util.Map">
		INSERT INTO dc_user_company (
      <if test="id != null and id !='' " >
          id
      </if>
      <if test="companyId != null" >
          ,companyId
      </if>
      <if test="uname != null" >
          ,uname
      </if>
      <if test="station != null" >
          ,station
      </if>
      <if test="mobile != null" >
          ,mobile
      </if>
      <if test="phone != null" >
          ,phone
      </if>
      <if test="email != null" >
          ,email
      </if>
      <if test="sex != null" >
          ,sex
      </if>
      <if test="birth != null" >
          ,birth
      </if>
      <if test="udesc != null" >
          ,udesc
      </if>
      <if test="userResource != null" >
          ,userResource
      </if>
      <if test="personAnalysis != null" >
          ,personAnalysis
      </if>
      <if test="createdBy != null" >
          ,createdBy
      </if>
      <if test="createDate != null" >
          ,createDate
      </if>
		)
		VALUES
			(
      <if test="id != null and id !='' " >
          #{id}
      </if>
      <if test="companyId != null" >
          ,#{companyId}
      </if>
      <if test="uname != null" >
          ,#{uname}
      </if>
      <if test="station != null" >
          ,#{station}
      </if>
      <if test="mobile != null" >
          ,#{mobile}
      </if>
      <if test="phone != null" >
          ,#{phone}
      </if>
      <if test="email != null" >
          ,#{email}
      </if>
      <if test="sex != null" >
          ,#{sex}
      </if>
      <if test="birth != null" >
          ,#{birth}
      </if>
      <if test="udesc != null" >
          ,#{udesc}
      </if>
      <if test="userResource != null" >
          ,#{userResource}
      </if>
      <if test="personAnalysis != null" >
          ,#{personAnalysis}
      </if>
      <if test="createdBy != null" >
          ,#{createdBy}
      </if>
      <if test="createDate != null" >
          ,#{createDate}
      </if>
			)
  </insert>
  

  
  

  
  
  
  
  <update id="updateUserInfoById"   >
    update dc_user_company set
          <if test="id != null and id !='' " >
              id=#{id},
          </if>
          <if test="companyId != null" >
              companyId=#{companyId},
          </if>
          <if test="uname != null" >
              uname=#{uname},
          </if>
          <if test="station != null" >
              station=#{station},
          </if>
          <if test="mobile != null" >
              mobile=#{mobile},
          </if>
          <if test="phone != null" >
              phone=#{phone},
          </if>
          <if test="email != null" >
              email=#{email},
          </if>
          <if test="sex != null" >
              sex=#{sex},
          </if>
          <if test="age != null" >
              age=#{age},
          </if>
          <if test="birth != null" >
              birth=#{birth},
          </if>
          <if test="udesc != null" >
              udesc=#{udesc},
          </if>
          <if test="userResource != null" >
              userResource=#{userResource},
          </if>
          <if test="personAnalysis != null" >
              personAnalysis=#{personAnalysis},
          </if>
          <if test="createdBy != null" >
              createdBy=#{createdBy},
          </if>
          <if test="createDate != null" >
              createDate=#{createDate},
          </if>
          <if test="updatedBy != null" >
              updatedBy=#{updatedBy},
          </if>
          <if test="updateDate != null" >
              updateDate=#{updateDate}
          </if>
    where id = #{id}
  </update>
  

  
  <delete id="deleteUserInfo">
    delete from dc_user_company where id=#{id}
  </delete>
  






    <select id="searchUserInfo" resultType="map">
            select
                du.uname,
                du.mobile,
                u.station,
                case when u.id=c.contactUserId then '是' else '否' end  as defaultContactor,
                c.companyName,
                c.id as companyId

             from  dc_user_company u inner join dc_company c on u.companyId=c.id INNER JOIN dc_user du on u.userId=du.id

            where  (du.mobile like '%${searchValue}%' or c.companyName like '%${searchValue}%')

            <if test="departmentIdList!=null and departmentIdList.size>0">
                and c.departmentId in
                <foreach item="departmentId" collection="departmentIdList" separator="," open="(" close=")" index="">
                    #{departmentId}
                </foreach>
            </if>

        limit #{start},#{pageSize}
    </select>


    <select id="searchUserInfoCount" resultType="int">
        select
        count(1)
        from  dc_user_company u inner join dc_company c on u.companyId=c.id INNER JOIN dc_user du on u.userId=du.id

        where  (du.mobile like '%${searchValue}%' or c.companyName like '%${searchValue}%')

        <if test="departmentIdList!=null and departmentIdList.size>0">
            and c.departmentId in
            <foreach item="departmentId" collection="departmentIdList" separator="," open="(" close=")" index="">
                #{departmentId}
            </foreach>
        </if>
    </select>


    <select id="selectUserInfoByMobileAndCompanyId" resultType="map">
                    select
                          id,
                          companyId,
                          uname,
                          station,
                          mobile,
                          phone,
                          email,
                          sex,
                          age,
                          birth,
                          udesc,
                          userResource,
                          personAnalysis,
                          createdBy,
                          createDate
            from dc_user_company d where d.companyId=#{companyId} and d.mobile=#{mobile}
    </select>



</mapper>